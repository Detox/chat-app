// Generated by LiveScript 1.5.0
/**
 * @package Detox chat app
 * @author  Nazar Mokrynskyi <nazar@mokrynskyi.com>
 * @license 0BSD
 */
(function(){
  var exec, fs, gulp, htmlmin, minify, SOURCE_FILE, MINIFIED_FILE, MINIFIED_DIR;
  exec = require('child_process').exec;
  fs = require('fs');
  gulp = require('gulp');
  htmlmin = require('gulp-htmlmin');
  minify = require('uglify-es').minify;
  SOURCE_FILE = 'html/index.html';
  MINIFIED_FILE = 'html/index.min.html';
  MINIFIED_DIR = 'html';
  gulp.task('build', ['minify-html', 'minify-js', 'build-index']).task('minify-html', ['bundle-webcomponents'], function(){
    return gulp.src('html/index.min.html').pipe(htmlmin({
      decodeEntities: true,
      minifyCSS: true,
      minifyJS: function(text){
        var result;
        result = minify(text);
        if (result.error) {
          console.log(result.error);
        }
        return result.code;
      },
      removeComments: true
    })).pipe(gulp.dest('html'));
  }).task('bundle-webcomponents', function(callback){
    var command;
    command = "node_modules/.bin/polymer-bundler --strip-comments --rewrite-urls-in-templates --inline-css --inline-scripts --out-html " + MINIFIED_FILE + " " + SOURCE_FILE;
    exec(command, function(error, stdout, stderr){
      var code;
      if (stdout) {
        console.log(stdout);
      }
      if (stderr) {
        console.error(stderr);
      }
      code = fs.readFileSync(MINIFIED_FILE, {
        encoding: 'utf8'
      });
      code = code.replace('<link rel="import" href="../node_modules/@polymer/shadycss/apply-shim.html">', '').replace('<link rel="import" href="../node_modules/@polymer/shadycss/custom-style-interface.html">', '').replace(/<\/script>\n+<script>/g, '');
      fs.writeFileSync(MINIFIED_FILE, code);
      callback(error);
    });
  }).task('minify-js', function(){}).task('build-index', function(){});
}).call(this);
